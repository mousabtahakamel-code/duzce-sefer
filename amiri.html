<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Hareket Amiri Paneli</title>
<style>
body{font-family:Arial;background:#eef2ff;margin:0;padding:20px;}
.card{background:white;max-width:500px;margin:auto;padding:20px;border-radius:10px;}
select,button{width:100%;padding:10px;margin-top:10px;}
button{background:#2563eb;color:white;border:none;border-radius:6px;cursor:pointer;}
#seferler{margin-top:15px;background:#f1f5f9;padding:10px;border-radius:6px;min-height:50px;}
</style>
</head>
<body>

<script>
const aktif = JSON.parse(localStorage.getItem("aktifKullanici"));
if(!aktif || aktif.page!=="amiri.html"){
  alert("Bu sayfaya giriş yetkiniz yok!");
  window.location.href="index.html";
}
</script>

<div class="card">
<h2>Hareket Amiri Paneli</h2>

<h3>Hat Seç</h3>
<select id="hat">
<option>1 - Üniversite Ring</option>
<option>30 - Bahçeşehir Ring</option>
<option>12 - Yeşiltepe - Otogar - Jandarma</option>
<option>25 - Sarayyeri - Otogar</option>
<option>26 - Akşemsettin - Otogar</option>
<option>46 - Mamure - Otogar</option>
<option>43 - Düzce Üniversitesi - Bahçeşehir</option>
</select>

<h3>Araç Seç</h3>
<select id="arac">
<option>Mavi Karsan Atak</option>
<option>Kırmızı Karsan Atak</option>
<option>TCV Karat</option>
<option>MAN Lions City G</option>
<option>Mercedes Conecto 2024</option>
<option>Otokar Sultan</option>
<option>BMC Procity TR</option>
</select>

<h3>Şoför Seç</h3>
<select id="sofor"></select>

<button onclick="kaydet()">Sefer Kaydet</button>
<p id="msg" style="color:green;"></p>

<div id="seferler"></div>

<button onclick="cikisYap()" style="margin-top:10px;background:#f87171;padding:10px;color:white;border:none;border-radius:6px;">Çıkış Yap</button>
</div>

<script>
let seferler=[];
let users=[];
async function fetchUsers(){ const res=await fetch('/api/users.js'); users=await res.json(); return users;}
async function fetchSeferler(){ const res=await fetch('/api/seferler.js'); seferler=await res.json(); return seferler;}
async function updateSeferler(){await fetch('/api/seferler.js',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(seferler,null,2)});}
async function init(){
  await fetchUsers();
  const soforler=users.filter(u=>u.page==="sofor.html");
  soforler.forEach(s=>sofor.innerHTML+=`<option value="${s.user}">${s.name}</option>`);
  await fetchSeferler();
  listele();
}
function listele(){
  const div=document.getElementById("seferler");
  div.innerHTML="<h3>Seferler</h3>";
  if(seferler.length===0){div.innerHTML+="Henüz sefer yok.";}
  seferler.forEach(s=>{div.innerHTML+=`<div>• ${s.hat} | ${s.arac} | ${s.sofor} | ${s.saat}</div>`;});
}
async function kaydet(){
  const yeni={
    hat:hat.value,
    arac:arac.value,
    sofor:sofor.value,
    saat:new Date().toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"})
  };
  seferler.push(yeni);
  await updateSeferler();
  msg.innerText="Sefer kaydedildi ✅";
  listele();
}
function cikisYap(){localStorage.removeItem("aktifKullanici"); window.location.href="index.html";}
init();
</script>

</body>
</html>
