<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Hareket Amiri</title>

<style>
body{font-family:Arial;background:#eef;padding:20px}
.box{background:white;padding:20px;max-width:1200px;margin:auto}

select,button{width:100%;padding:10px;margin-top:10px}

.time{padding:5px;margin:3px;font-size:12px}
.active{background:#2563eb;color:white}
.used{background:#999;color:white;cursor:not-allowed}

small{display:block;font-size:10px}

.tables{
  display:flex;
  gap:20px;
  margin-top:30px;
}
.tableBox{width:50%}

table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:5px;text-align:center}

.reset{background:#dc2626;color:white}
</style>
</head>
<body>

<div class="box">
<h3>Hareket Amiri</h3>

<select id="hat" onchange="hatKontrol()">
  <option value="1">1 - Üniversite Ring</option>
  <option value="30">30 - Bahçeşehir Ring</option>
  <option value="12">12 - Yeşiltepe - Otogar - Jandarma</option>
  <option value="25">25 - Sarayyeri - Otogar</option>
  <option value="26">26 - Akşemsettin - Otogar</option>
  <option value="46">46 - Mamure - Otogar</option>
  <option value="43">43 - Düzce Üniversitesi - Bahçeşehir</option>
</select>

<select id="yon">
  <option value="gidis">Gidiş</option>
  <option value="donus">Dönüş</option>
</select>

<select id="arac">
  <option>Mavi Karsan Atak</option>
  <option>Kırmızı Karsan Atak</option>
  <option>TCV Karat</option>
  <option>MAN Lions City G</option>
  <option>Mercedes Benz Conecto 2024</option>
  <option>Otokar Sultan</option>
  <option>BMC Procity TR</option>
</select>

<select id="sofor"></select>

<h4>Saatler</h4>
<div id="saatler"></div>

  <div class="tables">
  <div class="tableBox">
    <h4>Gidiş Seferleri</h4>
    <table id="gTablo">
      <tr><th>Hat</th><th>Saat</th><th>Şoför</th></tr>
    </table>
  </div>

  <div class="tableBox">
    <h4>Dönüş Seferleri</h4>
    <table id="dTablo">
      <tr><th>Hat</th><th>Saat</th><th>Şoför</th></tr>
    </table>
  </div>
</div>

<button onclick="ata()">Sefer Ata</button>
<button class="reset" onclick="resetSeferler()">Tüm Seferleri Sıfırla</button>

</div>

<script>
let users=JSON.parse(localStorage.getItem("users"))||[];
let seferler=JSON.parse(localStorage.getItem("seferler"))||[];
let secilen=[];

const saatler=document.getElementById("saatler");

function yukleSofor(){
  sofor.innerHTML="";
  users.filter(x=>x.role==="sofor").forEach(s=>{
    sofor.innerHTML+=`<option>${s.user}</option>`;
  });
}
yukleSofor();

/* 1 ve 30 sadece gidiş */
function hatKontrol(){
  if(hat.value==="1" || hat.value==="30"){
    yon.value="gidis";
    yon.disabled=true;
  }else{
    yon.disabled=false;
  }
  saatleriYukle();
}

/* Saatler – HAT + YÖN kilidi */
function saatleriYukle(){
  saatler.innerHTML="";
  for(let h=5;h<24;h++){
    for(let m=0;m<60;m+=5){
      const s=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;

      const kullanilan = seferler.find(x =>
        x.saat===s &&
        x.hat===hat.value &&
        x.yon===yon.value
      );

      const b=document.createElement("button");
      b.className="time";

      if(kullanilan){
        b.classList.add("used");
        b.innerHTML=s+`<small>${kullanilan.sofor}</small>`;
        b.disabled=true;
      }else{
        b.textContent=s;
        b.onclick=()=>{
          b.classList.toggle("active");
          secilen.includes(s)
            ? secilen=secilen.filter(x=>x!==s)
            : secilen.push(s);
        };
      }
      saatler.appendChild(b);
    }
  }
}

/* Ata */
function ata(){
  if(secilen.length===0) return alert("Saat seçmedin");

  secilen.forEach(s=>{
    seferler.push({
      id:crypto.randomUUID(),
      hat:hat.value,
      yon:yon.value,
      arac:arac.value,
      sofor:sofor.value,
      saat:s,
      durum:"Bekliyor"
    });
  });

  localStorage.setItem("seferler",JSON.stringify(seferler));
  secilen=[];
  saatleriYukle();
  listele();
}

/* Reset */
function resetSeferler(){
  if(!confirm("TÜM SEFERLER SİLİNECEK. Emin misin?")) return;
  seferler=[];
  localStorage.removeItem("seferler");
  saatleriYukle();
  listele();
}

/* Liste */
function listele(){
  gTablo.innerHTML="<tr><th>Hat</th><th>Saat</th><th>Şoför</th></tr>";
  dTablo.innerHTML="<tr><th>Hat</th><th>Saat</th><th>Şoför</th></tr>";

  seferler.forEach(s=>{
    const r=`<tr><td>${s.hat}</td><td>${s.saat}</td><td>${s.sofor}</td></tr>`;
    s.yon==="gidis"
      ? gTablo.innerHTML+=r
      : dTablo.innerHTML+=r;
  });
}

hatKontrol();
listele();
</script>

</body>
</html>




